{% extends 'base.html.twig' %}

{% block title %}ClawHQ | Agents{% endblock %}

{% block body %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4 clawhq-hero">
        <div>
            <h1 class="h3 mb-1" style="font-family: 'Comic Neue', 'Caveat', cursive; color: #7209b7;">Team Roster</h1>
            <p class="text-body-secondary mb-0">OpenClaw automated staff directory. Keep it clean!</p>
        </div>
        <div class="badge text-bg-warning rounded-pill px-3 py-2 shadow-sm" style="color: #2b2d42 !important; border: 2px dashed #e2e8f0; transform: rotate(3deg);">{{ agent_cards|length }} clocked in</div>
    </div>

    {% if agent_cards is empty %}
        <div class="card border-0 shadow-sm" style="border-radius: 15px; background: rgba(255,255,255,0.8); border: 2px dashed #cbd5e1 !important;">
            <div class="card-body p-5 text-center">
                <div style="font-size: 4rem; margin-bottom: 1rem; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));">ðŸ“­</div>
                <h2 class="h4 mb-2" style="font-family: 'Space Grotesk', sans-serif; font-weight: 700; color: #475569;">No agents at their desks</h2>
                <p class="mb-4 text-body-secondary" style="max-width: 500px; margin: 0 auto;">It's a bit quiet around here! Click the button below to get the prompt to invite your first OpenClaw agent to the office.</p>
                <button type="button" class="btn btn-primary btn-lg px-4 shadow-sm" style="border-radius: 10px;" data-bs-toggle="modal" data-bs-target="#inviteAgentModal">
                    + Invite Your First Agent
                </button>
            </div>
        </div>
    {% else %}
        <div class="row g-3">
            {% for card in agent_cards %}
                {% set agent = card.agent %}
                {% set counts = card.counts %}
                <div class="col-12 col-md-6 col-xl-4">
                    <div class="card h-100 border-0 shadow-sm card-agent">
                        <div class="card-body d-flex flex-column gap-3">
                            <div class="d-flex justify-content-between align-items-start gap-3">
                                <div class="d-flex align-items-center gap-3">
                                    <img src="https://api.dicebear.com/9.x/bottts/svg?seed={{ agent.name|url_encode }}&backgroundColor=e2e8f0" alt="Avatar" width="48" height="48" class="rounded-circle border shadow-sm">
                                    <div>
                                        <h2 class="h5 mb-1">{{ agent.displayName ?: agent.name }}</h2>
                                        <p class="small text-body-secondary mb-0">{{ agent.name }}</p>
                                    </div>
                                </div>
                                <span class="badge text-bg-{{ card.effective_state.value == 'working' ? 'primary' : (card.effective_state.value == 'blocked' ? 'danger' : 'success') }} text-uppercase">{{ card.effective_state.value }}</span>
                            </div>

                            <div class="small text-body-secondary">
                                Last seen:
                                {% if card.seconds_since_seen is null %}
                                    never
                                {% else %}
                                    {{ card.seconds_since_seen }}s ago
                                {% endif %}
                            </div>

                            <div class="d-flex gap-2 flex-wrap">
                                <span class="badge text-bg-light border">Todo {{ counts.todo|default(0) }}</span>
                                <span class="badge text-bg-light border">Doing {{ counts.doing|default(0) }}</span>
                                <span class="badge text-bg-light border">Done {{ counts.done|default(0) }}</span>
                            </div>

                            <div class="mt-auto d-flex gap-2">
                                <a href="{{ path('dashboard_agent_board', {id: agent.id}) }}" class="btn btn-sm btn-primary">Corkboard</a>
                                <a href="{{ path('dashboard_agent_status', {id: agent.id}) }}" class="btn btn-sm btn-outline-secondary">File</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}
